<!DOCTYPE html>
<html lang="fr">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta http-equiv="X-UA-Compatible" content="ie=edge">
 <title>Jeu du serpent</title>
</head>
<body>
<!-- Notre canvas -->
 <canvas id="zone" width="700" height="700"
 style="background-color:#C0C0C0;margin:0 auto;">
 Désolé, votre navigateur (ou sa version) ne prend pas en charge les "canvas".
 </canvas>
<script>
var canvas = document.getElementById("zone");
var ctx = canvas.getContext('2d');
 
var timeout = 0; 
 
 // position sur le canvas
 var depX=depY=0;
 var derMouv=1;
 var derMouvStop=0;
 
var largeur = hauteur = 20;
 // départ serpent au milieu du canvas (utilisé ici)
var x = Math.trunc(Math.random()*canvas.width/largeur)*largeur;
var y = Math.trunc(Math.random()*canvas.height/hauteur)*hauteur;
//var x= Math.trunc(Math.random()*canvas.width/largeur)*largeur; ;
//var y= Math.trunc(Math.random()*canvas.height/hauteur)*hauteur;


ctx.fillStyle="#F1C40F";
ctx.fillRect(x, y, largeur, hauteur);

//taille "pomme"
var pomLarg = pomHaut = 20;

// Position "pomme" aléatoire
var pomX= Math.trunc(Math.random()*canvas.width/largeur)*largeur; ;
var pomY= Math.trunc(Math.random()*canvas.height/hauteur)*hauteur;

/*
// Affichage de la 2pomme"
pom.fillStyle="#FF0000";
pom.fillRect(pomX, pomY, pomLarg, pomHaut);
*/

var trace=[];
var tailleTrace=1;
var sautTrace=5;
var tailleMaxTrace=1000; // Cette valeur sera changé plus tard (enfin, à voir)

var hist, compteBoucle = 0;
var sautBoucle = 100 ;

window.onload=function() {

	var intervalID = setInterval(jeu,100);  // rafraichissement toutes les 10millisecondes

	document.addEventListener("keydown",keyboard);

}

function jeu(){

x+=depX*largeur;  // déplacement horizontal
y+=depY*hauteur;  // déplacement vertical 

// pour faire en sorte de n'avoir que 1 point qui se déplace >> 
ctx.clearRect(largeur, hauteur, canvas.width-40, canvas.height-40); 
 
ctx.fillStyle="#F1C40F";
ctx.fillRect(x, y, largeur, hauteur);
 
 // Trace du serpent
trace.push({x:x,y:y});

// pour augmenter la trace du serpent toutes les X (ici 3) secondes
/*
if(tailleTrace <= tailleMaxTrace){
 if((compteBoucle++)%100 == 3){
 sautBoucle-- ;
 if(sautBoucle<0){
 tailleTrace+=sautTrace;
 }
 }
 }
*/

while(trace.length>tailleTrace){
 // pour enlèver un élément
 trace.shift();
 }
 
 for(var i=0;i<trace.length;i++) {
 ctx.fillRect(trace[i].x,trace[i].y, largeur, hauteur);
 }

// Il faut gérer la trace lors de la fonction pause car elle disparaît

		
 // Affichage de la 2pomme"
ctx.beginPath();
ctx.fillStyle="#FF0000";
ctx.fillRect(pomX, pomY, pomLarg, pomHaut);
ctx.closePath();
		
 // Action sur la "pomme"
 if( x==pomX && y==pomY){
 //Gestion du score quand il y aura
 //score+=10 + 2 * ((tailleTrace - tailleInitTrace)/sautTrace); 
 
 // collision
 // Dès que collision avec pomme, on augmente la taille (BUT : pour vérif la collision ici)
  if(tailleTrace<tailleMaxTrace){
 tailleTrace+=sautTrace;
 }
 // Si la taille a été augmenté on enlève un saut d'expansion de trace
 /*
 if(tailleTrace>tailleInitTrace){
 tailleTrace-=sautTrace;
 }
 */
 //sautBoucle = 10 ;
 //sautBoucle--;
}
else if(timeout++ >1000){
 timeout = 0 ;
 pomX = Math.trunc(Math.random()*canvas.width/largeur)*largeur;
 pomY= Math.trunc(Math.random()*canvas.height/hauteur)*largeur;
 }

}


function keyboard(evt){
//var timeoutTemp ;
 switch(evt.keyCode) {
 case 37:
 // touche gauche
 if(derMouv==39 || derMouv==68 || derMouv==32){break;}  // permettra de ne pas faire demi-tour
 depX=-1;
 depY=0;
 derMouv=evt.keyCode;
 break;
 
 case 65:
 // touche gauche (a)
 if(derMouv==39 || derMouv==68 || derMouv==32){break;}  // permettra de ne pas faire demi-tour
 depX=-1;
 depY=0;
 derMouv=evt.keyCode;
 break;
 
 case 38:
 // touche haut
 if(derMouv==40 || derMouv==83 || derMouv==32){break;}  // permettra de ne pas faire demi-tour
 depX=0;
 depY=-1;
 derMouv=evt.keyCode;
 break;

 case 87:
 // touche haut (w)
 if(derMouv==40 || derMouv==83 || derMouv==32){break;}  // permettra de ne pas faire demi-tour
 depX=0;
 depY=-1;
 derMouv=evt.keyCode;
 break;
 
 case 39:
 // touche droite
 if(derMouv==37 ||derMouv==65 || derMouv==32){break;}  // permettra de ne pas faire demi-tour
 depX=1;
 depY=0;
 derMouv=evt.keyCode;
 break;
 
 case 68:
 // touche droite (d)
 if(derMouv==37 ||derMouv==65 || derMouv==32){break;}  // permettra de ne pas faire demi-tour
 depX=1;
 depY=0;
 derMouv=evt.keyCode;
 break;
 
 case 40:
 // touche bas
 if(derMouv==38 || derMouv==87 || derMouv==32){break;}  // permettra de ne pas faire demi-tour
 depX=0;
 depY=1;
 derMouv=evt.keyCode;
 break;
 
 case 83:
 // touche bas (s)
 if(derMouv==38 || derMouv==87 || derMouv==32){break;}  // permettra de ne pas faire demi-tour
 depX=0;
 depY=1;
 derMouv=evt.keyCode;
 break;
 
 case 32:
 // touche espace pour pause ??
 // Gestion du redémarrage serpent dans la direction où il  allait
 if(derMouvStop==37 || derMouvStop==65){  
 depX=-1;
 depY=0;
 derMouv = derMouvStop;
 derMouvStop=evt.keyCode;
 break;
 }
 if(derMouvStop==38 || derMouvStop==87){  
 depX=0;
 depY=-1;
 derMouv = derMouvStop;
 derMouvStop=evt.keyCode;
 break;
 }
 if(derMouvStop==39 || derMouvStop==68) {
 depX=1;
 depY=0;
 derMouv = derMouvStop;
 derMouvStop=evt.keyCode;
 break;
 }
 if(derMouvStop==40 || derMouvStop==83 ){  
 depX=0;
 depY=1;
 derMouv = derMouvStop;
 derMouvStop=evt.keyCode;
 break;
 }
 depX=0;
 depY=0;
 derMouvStop = derMouv ;
 derMouv =evt.keyCode;
 break;
 
 }

}
 
</script>
</body>
</html>